## This time with single-species networks
library(asnipe)
library(igraph)
#import files
gmmDOWO=readRDS("conspecificDOWOflocks.rds") #import gmm results file. Will need this for permuting group-by-individual matrices.
gmmWBNU=readRDS("conspecificWBNUflocks.rds") #import gmm results file. Will need this for permuting group-by-individual matrices.
gbi_dowo=gmmDOWO$gbi
gbi_wbnu=gmmWBNU$gbi
dowoadj=get_network(gbi_dowo)
wbnuadj=get_network(gbi_wbnu)
diag(dowoadj)=NA
diag(wbnuadj)=NA
###
load("all_visits.dat")
load("weather.dat")
demo=read.csv("RFID_Records_fixed.csv")
all_visits
require(tidyverse)
demo
## daily visits per individual
dv <- all_visits %>%
filter(Date < "2019-03-11" & Date > "2019-01-25") %>%
group_by(RFID, Date) %>%
summarise(dailyvisits = n())
dv
## mean daily visits per individual
ref <- dv %>%
group_by(RFID) %>%
summarise(mdv = mean(dailyvisits)) %>%
ungroup()
## sd of daily visits
dvsd <- sd(dv$dailyvisits)
## build the df
require(reshape)
mat_ddm <- cast(dv, Date ~ RFID, value = "dailyvisits")
mat_ddm[is.na(mat_ddm)] <- 0
mat <- mat_ddm[2:46]/dvsd
myvec <- (ref$mdv[match(names(mat_ddm[2:45]), ref$RFID)])/dvsd
mat_final <- mat[1] - myvec[1]
for(i in 2:44){
mat_temp <- mat[i] - myvec[i]
mat_final <- cbind(mat_final, mat_temp)
}
mat_final
#weather dat
library(lubridate)
weather$Date <- as.Date(weather$Date, format = "%m/%d/%Y")
weather <- weather %>%
mutate(Hour = hour(datetime)) %>%
filter(Hour >= 19 | Hour <= 4) %>%
mutate(Lagdate = ifelse(Hour <= 4, paste0(lag(Date)), paste0(Date))) %>%
group_by(Date) %>%
summarize(nightlows = min(Temp_C)) %>%
ungroup()
weather
weather.use=weather[which(weather$Date>"2019-01-26"&weather$Date<"2019-03-10"),]
weather.use
morn_visits <- all_visits %>%
mutate(Hour = hour(Datetime)) %>%
mutate(Date = date(Datetime)) %>%
filter(Hour >= 6 | Hour <= 11) %>%
group_by(RFID, Date) %>%
summarise(sumvisits = n()) %>%
ungroup() %>%
left_join(weather, by = "Date") %>%
filter(Date < "2019-03-11" & Date > "2019-01-25")
morn_visits$RFID <- as.factor(morn_visits$RFID)
##dowo
dowovisits=mat_final[,which(colnames(mat_final)%in%rownames(dowoadj))]
dowovisits.mat=as.matrix(dowovisits)
dowoadj.bin=dowoadj
dowoadj.bin[which(dowoadj.bin>0)]=1
colSums(dowoadj.bin[1,]*t(dowovisits.mat), na.rm=T)
dowo.friend.activity=apply(dowoadj.bin, 1, function(x) colSums(x*t(dowovisits.mat), na.rm=T))
dowo.friend.activity=as.data.frame(dowo.friend.activity)
dowo.friend.activity
library(lme4)
library(lmerTest)
library(MuMIn)
dowovisits.dat=as.data.frame(dowovisits)
dowovisits.dat$Date=weather.use$Date
dowovisits.dat$nightlows=weather.use$nightlows
dowo.a= dowovisits.dat %>% gather("ID", "z_score", -Date, -nightlows)
dowo.a
dowo.friend.activity$Date=weather.use$Date
dowo.friend.activity$nightlows=weather.use$nightlows
dowo.b = dowo.friend.activity %>% gather("ID", "z_score_friends", -Date, -nightlows)
dowo.final.dat=merge(dowo.a,dowo.b)
dowo.final.dat
dowo.a
mod=lmer(z_score~nightlows+z_score_friends+(1|ID), data=dowo.final.dat)
summary(mod)
anova(mod)
r.squaredGLMM(mod)
mod=lmer(z_score_friends~nightlows+(1|ID), data=dowo.final.dat)
summary(mod)
r.squaredGLMM(mod)
##wbnu
wbnuvisits=mat_final[,which(colnames(mat_final)%in%rownames(wbnuadj))]
wbnuvisits.mat=as.matrix(wbnuvisits)
wbnuadj.trim=wbnuadj[which(rownames(wbnuadj)%in%colnames(mat_final)),which(rownames(wbnuadj)%in%colnames(mat_final))]
colSums(wbnuadj.trim[1,]*t(wbnuvisits.mat), na.rm=T)
wbnu.friend.activity=apply(wbnuadj.trim, 1, function(x) colSums(x*t(wbnuvisits.mat), na.rm=T))
wbnu.friend.activity=as.data.frame(wbnu.friend.activity)
wbnu.friend.activity
library(lme4)
library(lmerTest)
wbnuvisits.dat=as.data.frame(wbnuvisits)
wbnuvisits.dat$Date=weather.use$Date
wbnuvisits.dat$nightlows=weather.use$nightlows
wbnu.a= wbnuvisits.dat %>% gather("ID", "z_score", -Date, -nightlows)
wbnu.friend.activity$Date=weather.use$Date
wbnu.friend.activity$nightlows=weather.use$nightlows
wbnu.b = wbnu.friend.activity %>% gather("ID", "z_score_friends", -Date, -nightlows)
wbnu.final.dat=merge(a,b)
mod=lmer(z_score~nightlows+z_score_friends+(1|ID), data=wbnu.final.dat)
summary(mod)
r.squaredGLMM(mod)
wbnu.final.dat=merge(wbnu.a,wbnu.b)
mod=lmer(z_score~nightlows+z_score_friends+(1|ID), data=wbnu.final.dat)
summary(mod)
r.squaredGLMM(mod)
mod=lmer(z_score~nightlows+z_score_friends+(1|ID), data=dowo.final.dat)
summary(mod)
anova(mod)
r.squaredGLMM(mod)
gmmDOWO=readRDS("DOWOflocks.rds")
load("DOWOflocks.rds")
View(DOWOflocks)
DOWOflocks
load("DOWOflocks.rds")
load("WBNUflocks.rds")
gbi_dowo=DOWOflocks$gbi
gbi_dowo
class(DOWOflocks)
DOWOflocks[[1]]
DOWOflocks[[2]]
dowo.friend.activity
dowo.final.dat
##data
load("all_visits.dat")
load("weather.dat")
weather$Date <- as.Date(weather$Date, format = "%m/%d/%Y")
weather <- weather %>%
mutate(Hour = hour(datetime)) %>%
filter(Hour >= 19 | Hour <= 4) %>%
mutate(Lagdate = ifelse(Hour <= 4, paste0(lag(Date)), paste0(Date)))  %>%
group_by(Date) %>%
summarize(nightlows = min(Temp_C)) %>%
ungroup() %>%
mutate(index = as.numeric(Date-min(Date)+1))
#### PPNC Network and Temperature Paper
require(tidyverse)
require(lubridate)
weather <- weather %>%
mutate(Hour = hour(datetime)) %>%
filter(Hour >= 19 | Hour <= 4) %>%
mutate(Lagdate = ifelse(Hour <= 4, paste0(lag(Date)), paste0(Date)))  %>%
group_by(Date) %>%
summarize(nightlows = min(Temp_C)) %>%
ungroup() %>%
mutate(index = as.numeric(Date-min(Date)+1))
weather
demo <- read.csv("RFID_Records_fixed.csv")
demo <- demo %>%
select(-Date) %>%
filter(Species != "SCJU")
demo
## quick stats for results section
ndowo <- all_visits %>%
filter(Species == "DOWO")
nwbnu <- all_visits %>%
filter(Species == "WBNU")
ndowo
nwbnu
### Species Models for DOWO and WBNU
morn_visits <- all_visits %>%
mutate(Hour = hour(Datetime)) %>%
mutate(Date = date(Datetime)) %>%
filter(Hour >= 6 | Hour <= 11) %>%
group_by(RFID, Date) %>%
summarise(sumvisits = n()) %>%
ungroup() %>%
left_join(weather, by = "Date") %>%
left_join(demo, by = "RFID") %>%
select(Date, RFID, Species, Weight, Tarsus, Wing, Sex, Age, Culmen, nightlows, sumvisits) %>%
filter(Date < "2019-03-11" & Date > "2019-01-25") %>%
filter(Species == "DOWO" | Species == "WBNU")
morn_visits$RFID <- as.factor(morn_visits$RFID)
newdata <- morn_visits[-9]
newdata
require(mgcv)
md <- gamm(sumvisits ~ s(nightlows, fx = FALSE, bs = "tp") + s(RFID, bs = "re"),
family = poisson,
data = morn_visits %>% filter(Species == "DOWO"))
summary(md$gam)
summary(md$lme)
plot(md$gam)
mw <- gamm(sumvisits ~ s(nightlows, fx = FALSE, bs = "tp") + s(RFID, bs = "re"),
family = poisson,
data = morn_visits %>% filter(Species == "WBNU"))
summary(mw$gam)
summary(mw$lme)
plot(mw$gam)
morn_visits
morn_visits$sumvisits
with(subset(morn_visits, Species=="WBNU"), plot(nightlows, sumvisits))
with(subset(morn_visits, Species=="WBNU"), plot(lag(nightlows), sumvisits))
?lag
with(subset(morn_visits, Species=="WBNU"), plot(dplyr::lag(nightlows), sumvisits))
dplyr::lag(nightlows)
morn_visits %>% filter(Species=="WBNU")
morn_visits %>% filter(Species=="WBNU") %>% dplyr::lag(nightlows)
morn_visits %>% filter(Species=="WBNU") %>% mutate(lag1=dplyr::lag(nightlows)
)
morn_visits %>% filter(Species=="WBNU") %>% mutate(lag1=dplyr::lag(nightlows)) %>% mutate(lead1=dplyr::lead(nightlows))
wbnudat1=morn_visits %>% filter(Species=="WBNU") %>% group_by(RFID) %>% mutate(lag1=dplyr::lag(nightlows)) %>% mutate(lead1=dplyr::lead(nightlows))
wbnudat1
wbnudat1[,5:13]
mw <- gamm(sumvisits ~ s(nightlows, fx = FALSE, bs = "tp") + s(RFID, bs = "re"),
family = poisson,
data = wbnudat1)
summary(mw$gam)
summary(mw$lme)
mw <- gamm(sumvisits ~ s(lag1, fx = FALSE, bs = "tp") + s(RFID, bs = "re"),
family = poisson,
data = wbnudat1)
summary(mw$gam)
summary(mw$lme)
plot(mw$gam)
mw <- gamm(sumvisits ~ s(lead1, fx = FALSE, bs = "tp") + s(RFID, bs = "re"),
family = poisson,
data = wbnudat1)
summary(mw$gam)
summary(mw$lme)
plot(mw$gam)
family = poisson,
data = wbnudat1)
mw <- gamm(sumvisits ~ s(nightlows, fx = FALSE, bs = "tp") + s(RFID, bs = "re"),
family = poisson,
data = wbnudat1)
summary(mw$gam)
summary(mw$lme)
plot(mw$gam)
mw <- gamm(sumvisits ~ s(lag1, fx = FALSE, bs = "tp") + s(RFID, bs = "re"),
family = poisson,
data = wbnudat1)
summary(mw$gam)
summary(mw$lme)
plot(mw$gam)
family = poisson,
data = wbnudat1)
mw <- gamm(sumvisits ~ s(nightlows, fx = FALSE, bs = "tp") + s(RFID, bs = "re"),
family = poisson,
data = wbnudat1)
summary(mw$gam)
summary(mw$lme)
plot(mw$gam)
newdat2=newdata %>% filter(Species=="WBNU") %>% group_by(RFID) %>% mutate(lag1=dplyr::lag(nightlows)) %>% mutate(lead1=dplyr::lead(nightlows))
require(lme4)
test_dowo <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = morn_visits %>% filter(Species == "DOWO"), family = "poisson")
plot(resid(test))
test_wbnu <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = morn_visits %>% filter(Species == "WBNU"), family = "poisson")
plot(resid(test))
plot(resid(test_dowo))
plot(resid(test_wbnu))
library(rsq)
library(MuMIn)
library(arm)
r.squaredGLMM(test_dowo)
r.squaredGLMM(test_wbnu)
test_dowo <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = newdat2 %>% filter(Species == "DOWO"), family = "poisson")
newdat2
newdat2=newdata %>%  group_by(RFID) %>% mutate(lag1=dplyr::lag(nightlows)) %>% mutate(lead1=dplyr::lead(nightlows))
test_dowo <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = newdat2 %>% filter(Species == "DOWO"), family = "poisson")
plot(resid(test_dowo))
test_wbnu <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = morn_visits %>% filter(Species == "WBNU"), family = "poisson")
plot(resid(test_wbnu))
library(rsq)
library(MuMIn)
library(arm)
r.squaredGLMM(test_dowo)
r.squaredGLMM(test_wbnu)
install.packages('rsq')
library(rsq)
r.squaredGLMM(test_dowo)
r.squaredGLMM(test_wbnu)
test_dowo_lag <- glmer(sumvisits ~ scale(lag1) + (1|RFID), data = newdat2 %>% filter(Species == "DOWO"), family = "poisson")
r.squaredGLMM(test_dowo_lag)
test_dowo_lag <- glmer(sumvisits ~ scale(lag1) + (1|RFID), data = newdat2 %>% filter(Species == "DOWO"), family = "poisson")
test_dowo_lag
summary(test_dowo_lag)
r.squaredGLMM(test_dowo_lag)
test_wbnu <- glmer(sumvisits ~ scale(lag1) + (1|RFID), data = morn_visits %>% filter(Species == "WBNU"), family = "poisson")
test_wbnu <- glmer(sumvisits ~ scale(lag1) + (1|RFID), data = newdat2 %>% filter(Species == "WBNU"), family = "poisson")
summary(test_dowo_lag)
test_wbnu_lag <- glmer(sumvisits ~ scale(lag1) + (1|RFID), data = newdat2 %>% filter(Species == "WBNU"), family = "poisson")
summary(test_wbnu_lag)
summary(test_wbnu)
test_wbnu_lag <- glmer(sumvisits ~ scale(lag1) + (1|RFID), data = newdat2 %>% filter(Species == "WBNU"), family = "poisson")
summary(test_wbnu_lag)
test_wbnu <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = morn_visits %>% filter(Species == "WBNU"), family = "poisson")
summary(test_wbnu)
newdat2
newdat2[,5:13]
newdat2[,5:12]
test_dowo_lag <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = newdat2 %>% filter(Species == "DOWO"), family = "poisson")
summary(test_dowo_lag)
test_wbnu_lag <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = newdat2 %>% filter(Species == "WBNU"), family = "poisson")
summary(test_wbnu_lag)
?scale
test_dowo_lag <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = newdat2 %>% filter(Species == "DOWO") %>% filter(is.na(nightlows)==F), family = "poisson")
summary(test_dowo_lag)
test_wbnu_lag <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = newdat2 %>% filter(Species == "WBNU") %>% filter(is.na(nightlows)==F), family = "poisson")
summary(test_wbnu_lag)
test_dowo_lag <- glmer(sumvisits ~ scale(lag1) + (1|RFID), data = newdat2 %>% filter(Species == "DOWO") %>% filter(is.na(lag1)==F), family = "poisson")
summary(test_dowo_lag)
test_wbnu_lag <- glmer(sumvisits ~ scale(lag1) + (1|RFID), data = newdat2 %>% filter(Species == "WBNU") %>% filter(is.na(lag1)==F), family = "poisson")
summary(test_wbnu_lag)
scale(newdat2$lag1)
summary(test_wbnu_lag)
summary(test_wbnu)
test_wbnu_lead <- glmer(sumvisits ~ scale(lead1) + (1|RFID), data = newdat2 %>% filter(Species == "WBNU") %>% filter(is.na(lead1)==F), family = "poisson")
summary(test_wbnu_lead)
test_wbnu_lag <- glmer(sumvisits ~ scale(lag1) + (1|RFID), data = newdat2 %>% filter(Species == "WBNU") %>% filter(is.na(lag1)==F), family = "poisson")
summary(test_wbnu_lead)
r.squaredGLMM(test_dowo_lag)
r.squaredGLMM(test_wbnu_lag)
test_dowo <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = newdat2 %>% filter(Species == "DOWO"), family = "poisson")
plot(resid(test_dowo))
test_wbnu <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = morn_visits %>% filter(Species == "WBNU"), family = "poisson")
plot(resid(test_wbnu))
r.squaredGLMM(test_dowo)
r.squaredGLMM(test_wbnu)
test_dowo <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = newdat2 %>% filter(Species == "DOWO"), family = "poisson")
plot(resid(test_dowo))
test_wbnu <- glmer(sumvisits ~ scale(nightlows) + (1|RFID), data = morn_visits %>% filter(Species == "WBNU"), family = "poisson")
plot(resid(test_wbnu))
r.squaredGLMM(test_dowo)
r.squaredGLMM(test_wbnu)
test_dowo_lag <- glmer(sumvisits ~ scale(lag1) + (1|RFID), data = newdat2 %>% filter(Species == "DOWO") %>% filter(is.na(lag1)==F), family = "poisson")
summary(test_dowo_lag)
test_wbnu_lag <- glmer(sumvisits ~ scale(lag1) + (1|RFID), data = newdat2 %>% filter(Species == "WBNU") %>% filter(is.na(lag1)==F), family = "poisson")
summary(test_wbnu_lead)
test_dowo_lead <- glmer(sumvisits ~ scale(lead1) + (1|RFID), data = newdat2 %>% filter(Species == "DOWO") %>% filter(is.na(lead1)==F), family = "poisson")
summary(test_dowo_lead)
test_wbnu_lead <- glmer(sumvisits ~ scale(lead1) + (1|RFID), data = newdat2 %>% filter(Species == "WBNU") %>% filter(is.na(lead1)==F), family = "poisson")
summary(test_wbnu_lead)
r.squaredGLMM(test_dowo)
r.squaredGLMM(test_wbnu)
r.squaredGLMM(test_dowo_lag)
r.squaredGLMM(test_wbnu_lag)
r.squaredGLMM(test_dowo_lead)
r.squaredGLMM(test_wbnu_lead)
